<html>
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <script src="https://unpkg.com/@metamask/detect-provider/dist/detect-provider.min.js"></script>
    <!-- CSS Reset -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css"
    />
    <!-- Milligram CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.css"
    />
    <!-- Font -->
    <link
      rel="stylesheet"
      media="screen"
      href="https://fontlibrary.org//face/source-code-pro"
      type="text/css"
    />
    <style type="text/css">
      * {
        box-sizing: border-box;
      }
      body {
        font-family: "SourceCodeProRegular";
        color: #414141;
      }
      .container {
        margin: 1em auto;
      }
      .row {
        margin-bottom: 1em;
      }
      h1 {
        text-transform: uppercase;
      }
      h4 {
        border-bottom: 0.3rem solid #0000b4;
      }
      pre {
        border-left: 0.3rem solid #0000b4;
      }
      td,
      th {
        vertical-align: top;
      }
      table {
        border-collapse: collapse;
      }
      tbody tr {
        animation-duration: 2s;
        animation-name: showrow;
        border-left: 0.3rem solid #fff;
      }
      @keyframes showrow {
        from {
          border-left: 0.3rem solid #0000b4;
        }

        to {
          border-left: 0.3rem solid #fff;
        }
      }
      dl {
        width: 100%;
        padding: 0;
        margin: 0;
      }
      dt {
        float: left;
        width: 30%;
        padding: 0;
        margin: 0;
        font-weight: bold;
      }
      dd {
        float: left;
        width: 70%;
        padding: 0;
        margin: 0;
      }
      #how-to {
        background-color: #eee;
      }
      #show-setup a,
      #close-setup a {
        text-transform: uppercase;
        background: linear-gradient(270deg, #000050, #0000b4);
        border-radius: 25px;
        color: #fff;
        font-size: 1em;
      }
      #show-setup a:hover,
      #close-setup a:hover {
        color: #ffffa0;
      }
      [hidden] {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="column column-100">
          <h1>Dishonest Ethereum RPC Provider</h1>
          <p>
            But I must explain to you how all this mistaken idea of denouncing
            pleasure and praising pain was born and I will give you a complete
            account of the system, and expound the actual teachings of the great
            explorer of the truth, the master-builder of human happiness. No one
            rejects, dislikes, or avoids pleasure itself, because it is
            pleasure, but because those who do not know how to pursue pleasure
            rationally encounter consequences that are extremely painful. Nor
            again is there anyone who loves or pursues or desires to obtain pain
            of itself, because it is pain, but because occasionally
          </p>
        </div>
      </div>
      <div class="row">
        <div class="column column-50"></div>
        <div class="column column-50">
          <h5>Profitable</h5>
          <p>
            But I must explain to you how all this mistaken idea of denouncing
            pleasure and praising pain was born and I will give you a complete
            account of the system, and expound the actual teachings of the great
            explorer of the truth, the master-builder of human happiness. No one
            rejects, dislikes, or avoids pleasure itself, because it is
            pleasure, but because those who do not know how to pursue pleasure
            rationally encounter consequences that are extremely painful. Nor
            again is there anyone who loves or pursues or desires to obtain pain
            of itself, because it is pain, but because occasionally
          </p>
        </div>
      </div>
      <div class="row" id="show-setup">
        <div class="column">
          <a class="button float-left" href="#" onClick="toggleSetup()"
            >Setup (very easy)</a
          >
        </div>
      </div>
      <div class="row" id="how-to" hidden>
        <div class="container">
          <div class="row" id="close-setup">
            <div class="column">
              <a class="button float-right" href="#" onClick="toggleSetup()"
                >Close</a
              >
            </div>
          </div>
          <div class="row">
            <div class="column column-50"></div>
            <div class="column column-50">
              <h5>Step 1</h5>
              <p>
                But I must explain to you how all this mistaken idea of
                denouncing pleasure and praising pain was born and I will give
                you a complete account of the system, and expound the actual
                teachings of the great explorer of the truth, the master-builder
                of human happiness. No one rejects, dislikes, or avoids pleasure
                itself, because it is pleasure, but because those who do not
                know how to pursue pleasure rationally encounter consequences
                that are extremely painful. Nor again is there anyone who loves
                or pursues or desires to obtain pain of itself, because it is
                pain, but because occasionally
              </p>
            </div>
          </div>
          <div class="row">
            <div class="column column-50"></div>
            <div class="column column-50">
              <h5>Step 2</h5>
              <p>
                But I must explain to you how all this mistaken idea of
                denouncing pleasure and praising pain was born and I will give
                you a complete account of the system, and expound the actual
                teachings of the great explorer of the truth, the master-builder
                of human happiness. No one rejects, dislikes, or avoids pleasure
                itself, because it is pleasure, but because those who do not
                know how to pursue pleasure rationally encounter consequences
                that are extremely painful. Nor again is there anyone who loves
                or pursues or desires to obtain pain of itself, because it is
                pain, but because occasionally
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="column column-30">
          <h4>IP</h4>
          <div id="client-ip"></div>
        </div>
        <div class="column column-10">
          <h4>Country</h4>
          <div id="client-country"></div>
        </div>
        <div class="column column-20">
          <h4>Status</h4>
          <div id="client-connection-status"></div>
        </div>
        <div class="column column-40">
          <h4>MetaMask Network Settings</h4>
          <dl>
            <dt>Network Name</dt>
            <dd>DERP - ETH Mainnet</dd>
            <dt>RPC Url</dt>
            <dd id="rpc-url"></dd>
            <dt>Chain ID</dt>
            <dd>1</dd>
          </dl>
        </div>
      </div>
      <div class="row">
        <div class="column">
          <h4>Logs</h4>
          <table id="client-logs">
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>Type</th>
                <th>User Agent</th>
                <th>Method</th>
                <th>Params</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript">
    let currentWebSocket;

    const tableCells = ["timestamp", "type", "userAgent", "method", "params"];

    const toggleSetup = () => {
      const howtoDiv = document.getElementById("how-to");
      const showsetupDiv = document.getElementById("show-setup");
      howtoDiv.hidden = !howtoDiv.hidden;
      showsetupDiv.hidden = !showsetupDiv.hidden;
    };

    const updateIp = (ip, country) => {
      const ipDiv = document.getElementById("client-ip");
      ipDiv.textContent = ip;
      const countryDiv = document.getElementById("client-country");
      countryDiv.textContent = country;
    };

    const setConnectionStatus = () => {
      const connectionDiv = document.getElementById("client-connection-status");
      connectionDiv.textContent = "connected";
    };

    const unsetConnectionStatus = () => {
      const connectionDiv = document.getElementById("client-connection-status");
      connectionDiv.textContent = "not connected";
    };

    const setRpcUrl = () => {
      const div = document.getElementById("rpc-url");
      div.textContent = `https://${location.host}/rpc/eth/mainnet`;
    };

    const addLogEntry = (entry) => {
      const table = document.getElementById("client-logs");
      const tableBody = table.getElementsByTagName("tbody")[0];
      const tableRow = tableBody.insertRow(0);
      tableCells.forEach((name) => {
        const cell = tableRow.insertCell();
        let cellContent = document.createTextNode(entry[name]);
        if (name == "params") {
          cellContent = document.createElement("pre");
          const text = document.createTextNode(
            JSON.stringify(entry[name], null, 2)
          );
          cellContent.appendChild(text);
        }
        cell.appendChild(cellContent);
      });
    };

    const join = () => {
      const wsUrl = `wss://${location.host}/client_logs/websocket`;
      const ws = new WebSocket(wsUrl);

      ws.addEventListener("open", (event) => {
        console.log("websocket opened");
        currentWebSocket = ws;
        setConnectionStatus();
      });

      ws.addEventListener("message", (event) => {
        const data = JSON.parse(event.data);
        console.log("received websocket message", event.data);
        addLogEntry(data.log);
        updateIp(data.ip, data.country);
      });

      ws.addEventListener("close", (event) => {
        console.log(
          "websocket closed, reconnecting:",
          event.code,
          event.reason
        );
        unsetConnectionStatus();
        join();
      });

      ws.addEventListener("error", (event) => {
        console.log("websocket error, reconnecting:", event);
        unsetConnectionStatus();
        join();
      });
    };

    window.addEventListener(
      "load",
      async () => {
        unsetConnectionStatus();
        setRpcUrl();
        join();
      },
      false
    );
  </script>
</html>
